pipeline {
	agent none
		
	
	environment {
		#MVN_CONFIG_ID = "3d1a1dac-4b94-43ba-b36b-bb80892e4576"
		M2_WORKSPACE = "${env.WORKSPACE}/.m2"
		M2_REPO = "${env.WORKSPACE}/.repository"
		M2_SETTINGS = "${env.M2_WORKSPACE}/settings.xml"
		// not to confuse with MAVEN_OPTS which is JVM opts only!
		MAVEN_ARGS = "-B -V -Dmaven.repo.local=${env.M2_REPO} -s ${env.M2_SETTINGS}"
		MVN_CMD = "mvn ${env.MAVEN_ARGS}"
	}

	stages {
		stage ('Build') {
                  agent {
                    kubernetes {
                      label "kubeagent"
                      defaultContainer 'jnlp'
                      yamlfile ".jenkins/build-pod.yaml"
                     }
                 }
                  steps {
                    container('maven') {
		       sh "${env.MVN_CMD} clean deploy}"
		      }
		    container('oc') {
		       dockerBuild(image: "${IMAGE_NAME}") 
		      }
		  }
             }
	 }
   }
